import type {
  CaseRecord,
  IDPEntity,
  PolicyEntity,
  WorkflowEvent,
  CaseDocument,
  TransactionTypeConfig,
  DecisionTable,
  GoodOrderCheck,
  EntityField,
} from '../types/entities';

// ─── Transaction Type Registry ─────────────────────────────────────────────────
export const TRANSACTION_TYPE_REGISTRY: TransactionTypeConfig[] = [
  {
    key: 'LIFE_LOAN',
    displayName: 'Policy Loan Request',
    lineOfBusiness: 'Life',
    idpTemplateRef: 'IDP_TMPL_LOAN_V2',
    decisionTableRef: 'DT_LOAN_TRIAGE_V1',
    formLayoutRef: 'LAYOUT_LOAN_FIELDS',
    goodOrderChecklistRef: 'GOC_LOAN_STANDARD',
    confidenceThresholds: { default: 90, signature: 95, amounts: 85 },
  },
  {
    key: 'ANNUITY_WITHDRAWAL',
    displayName: 'Annuity Single Withdrawal',
    lineOfBusiness: 'Annuity',
    idpTemplateRef: 'IDP_TMPL_ANNUITY_WD_V1',
    decisionTableRef: 'DT_WITHDRAWAL_TRIAGE_V1',
    formLayoutRef: 'LAYOUT_WITHDRAWAL_FIELDS',
    goodOrderChecklistRef: 'GOC_WITHDRAWAL_STANDARD',
    confidenceThresholds: { default: 90, signature: 95, amounts: 85 },
  },
  {
    key: 'LIFE_FULL_SURRENDER',
    displayName: 'Full Surrender',
    lineOfBusiness: 'Life / Annuity',
    idpTemplateRef: 'IDP_TMPL_SURRENDER_V1',
    decisionTableRef: 'DT_SURRENDER_TRIAGE_V1',
    formLayoutRef: 'LAYOUT_SURRENDER_FIELDS',
    goodOrderChecklistRef: 'GOC_SURRENDER_STANDARD',
    confidenceThresholds: { default: 90, signature: 95, amounts: 85 },
  },
  {
    key: 'ANNUITY_RMD',
    displayName: 'Annuity RMD Distribution',
    lineOfBusiness: 'Annuity',
    idpTemplateRef: 'IDP_TMPL_RMD_V1',
    decisionTableRef: 'DT_RMD_TRIAGE_V1',
    formLayoutRef: 'LAYOUT_RMD_FIELDS',
    goodOrderChecklistRef: 'GOC_RMD_STANDARD',
    confidenceThresholds: { default: 90, signature: 95, amounts: 85 },
  },
  {
    key: 'LIFE_PARTIAL_SURRENDER',
    displayName: 'Partial Surrender',
    lineOfBusiness: 'Life / Annuity',
    idpTemplateRef: 'IDP_TMPL_PARTIAL_SURRENDER_V1',
    decisionTableRef: 'DT_PARTIAL_SURRENDER_TRIAGE_V1',
    formLayoutRef: 'LAYOUT_PARTIAL_SURRENDER_FIELDS',
    goodOrderChecklistRef: 'GOC_PARTIAL_SURRENDER_STANDARD',
    confidenceThresholds: { default: 90, signature: 95, amounts: 85 },
  },
];

// ─── Demo Scenario 1: Policy Loan (Moderate Touch) ────────────────────────────
export const LOAN_CASE: CaseRecord = {
  id: 'CSE-2026-010847',
  policyNumber: 'LF-2024-089423',
  ownerName: 'James R. Whitfield',
  transactionType: 'Policy Loan Request',
  transactionTypeKey: 'LIFE_LOAN',
  channelSource: 'Mail / Fax',
  status: 'PENDING_VALIDATION',
  createdAt: '2026-02-20T09:14:32Z',
};

export const LOAN_IDP_ENTITIES: IDPEntity[] = [
  // Identity Group — matches Wilton Reassurance Loan Request Form (Rev 08/2016)
  {
    fieldName: 'policy_number',
    displayName: 'Policy Number',
    extractedValue: 'LF-2024-089423',
    confidenceScore: 99,
    validated: false,
    corrected: false,
    matchStatus: 'match',
    policyValue: 'LF-2024-089423',
    group: 'identity',
    required: true,
  },
  {
    fieldName: 'insured_name',
    displayName: "Insured's Name",
    extractedValue: 'James R. Whitfield',
    confidenceScore: 98,
    validated: false,
    corrected: false,
    matchStatus: 'match',
    policyValue: 'James R. Whitfield',
    group: 'identity',
    required: true,
  },
  {
    fieldName: 'owner_name',
    displayName: "Owner's Name",
    extractedValue: 'James R. Whitfield',
    confidenceScore: 98,
    validated: false,
    corrected: false,
    matchStatus: 'match',
    policyValue: 'James R. Whitfield',
    group: 'identity',
    required: true,
  },
  {
    fieldName: 'owner_ssn_last4',
    displayName: "Owner's SS # / Tax ID (Last 4)",
    extractedValue: '7823',
    confidenceScore: 94,
    validated: false,
    corrected: false,
    matchStatus: 'match',
    policyValue: '7823',
    group: 'identity',
    required: true,
  },
  {
    fieldName: 'owner_phone',
    displayName: "Owner's Daytime Phone",
    extractedValue: '(404) 555-0182',
    confidenceScore: 89,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'identity',
    required: false,
  },
  {
    fieldName: 'owner_signature',
    displayName: 'Owner Signature',
    extractedValue: 'Present',
    confidenceScore: 91,
    validated: false,
    corrected: false,
    matchStatus: 'match',
    group: 'identity',
    required: true,
  },
  {
    fieldName: 'date_signed',
    displayName: 'Signature Date',
    extractedValue: '02/18/2026',
    confidenceScore: 97,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'identity',
    required: true,
  },
  {
    fieldName: 'alternate_payee_name',
    displayName: 'Alternate Payee Name',
    extractedValue: '(blank)',
    confidenceScore: 96,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'identity',
    required: false,
  },
  // Financial Group — Loan Request specifics
  {
    fieldName: 'loan_request_type',
    displayName: 'Loan Request Type',
    extractedValue: 'Specific Amount',
    confidenceScore: 96,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'financial',
    required: true,
  },
  {
    fieldName: 'requested_amount',
    displayName: 'Requested Loan Amount',
    extractedValue: '$75,000.00',
    confidenceScore: 92,
    validated: false,
    corrected: false,
    matchStatus: 'pending',
    group: 'financial',
    required: true,
  },
  {
    fieldName: 'owner_address',
    displayName: 'Mailing Address',
    extractedValue: '1842 Oakridge Drive, Atlanta, GA 30301',
    confidenceScore: 87,
    validated: false,
    corrected: false,
    matchStatus: 'mismatch',
    policyValue: '1842 Oakridge Dr, Atlanta, GA 30301',
    group: 'identity',
    required: false,
  },
  // Payment Group
  {
    fieldName: 'payment_method',
    displayName: 'Disbursement Method',
    extractedValue: 'Check — Owner Address on File',
    confidenceScore: 88,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'payment',
    required: true,
  },
  // Tax Group — Loan Request Form includes W-9 certification
  {
    fieldName: 'tax_withholding_federal',
    displayName: 'Federal Withholding Election',
    extractedValue: 'No Withholding',
    confidenceScore: 79,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'tax',
    required: true,
  },
  {
    fieldName: 'w9_certified',
    displayName: 'W-9 / SSN Certification',
    extractedValue: 'Certified',
    confidenceScore: 95,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'tax',
    required: true,
  },
];

export const LOAN_POLICY_ENTITIES: PolicyEntity[] = [
  {
    fieldName: 'policy_status',
    displayName: 'Policy Status',
    value: 'Active',
    retrievedAt: '2026-02-20T09:14:45Z',
    sourceSystem: 'Admin System',
    category: 'Status',
  },
  {
    fieldName: 'cash_surrender_value',
    displayName: 'Cash Surrender Value',
    value: '$120,000.00',
    retrievedAt: '2026-02-20T09:14:45Z',
    sourceSystem: 'Admin System',
    category: 'Financials',
  },
  {
    fieldName: 'existing_loan_balance',
    displayName: 'Existing Loan Balance',
    value: '$10,000.00',
    retrievedAt: '2026-02-20T09:14:45Z',
    sourceSystem: 'Admin System',
    category: 'Financials',
  },
  {
    fieldName: 'max_loan_available',
    displayName: 'Maximum Loan Available',
    value: '$110,000.00',
    retrievedAt: '2026-02-20T09:14:45Z',
    sourceSystem: 'Admin System',
    category: 'Financials',
  },
  {
    fieldName: 'loan_interest_rate',
    displayName: 'Loan Interest Rate',
    value: '5.50%',
    retrievedAt: '2026-02-20T09:14:45Z',
    sourceSystem: 'Admin System',
    category: 'Financials',
  },
  {
    fieldName: 'policy_issue_date',
    displayName: 'Policy Issue Date',
    value: '03/15/2008',
    retrievedAt: '2026-02-20T09:14:45Z',
    sourceSystem: 'Admin System',
    category: 'Policy Details',
  },
  {
    fieldName: 'tax_qualification',
    displayName: 'Tax Qualification',
    value: 'Non-Qualified',
    retrievedAt: '2026-02-20T09:14:45Z',
    sourceSystem: 'Admin System',
    category: 'Tax',
  },
  {
    fieldName: 'owner_name_policy',
    displayName: 'Owner Name (System)',
    value: 'James R. Whitfield',
    retrievedAt: '2026-02-20T09:14:45Z',
    sourceSystem: 'Admin System',
    category: 'Identity',
  },
  {
    fieldName: 'owner_dob',
    displayName: 'Owner Date of Birth',
    value: '09/12/1962',
    retrievedAt: '2026-02-20T09:14:45Z',
    sourceSystem: 'Admin System',
    category: 'Identity',
  },
];

export const LOAN_WORKFLOW_EVENTS: WorkflowEvent[] = [
  {
    id: 'WE-001',
    eventType: 'CASE_CREATED',
    description: 'Case created from Mail/Fax intake channel',
    actor: 'System',
    timestamp: '2026-02-20T09:14:32Z',
  },
  {
    id: 'WE-002',
    eventType: 'DOCUMENT_RECEIVED',
    description: 'Loan request form received — 2 pages',
    actor: 'System',
    timestamp: '2026-02-20T09:14:33Z',
  },
  {
    id: 'WE-003',
    eventType: 'IDP_QUEUED',
    description: 'Document queued for IDP extraction — Template: IDP_TMPL_LOAN_V2',
    actor: 'System',
    timestamp: '2026-02-20T09:14:34Z',
  },
  {
    id: 'WE-004',
    eventType: 'IDP_COMPLETE',
    description: 'IDP extraction complete — 13 fields extracted, 4 below confidence threshold',
    actor: 'Assure IDP Service',
    timestamp: '2026-02-20T09:15:12Z',
  },
  {
    id: 'WE-005',
    eventType: 'POLICY_DATA_RETRIEVED',
    description: 'Policy data retrieved from Admin System — 9 fields loaded',
    actor: 'System',
    timestamp: '2026-02-20T09:15:14Z',
  },
];

export const LOAN_DOCUMENTS: CaseDocument[] = [
  {
    id: 'DOC-001',
    name: 'Loan_Request_Form_LF089423.pdf',
    type: 'Policy Loan Request',
    sizeMB: 1.2,
    uploadedAt: '2026-02-20T09:14:33Z',
    idpStatus: 'complete',
    pageCount: 2,
  },
  {
    id: 'DOC-002',
    name: 'Bank_Verification_Letter.pdf',
    type: 'Supporting Document',
    sizeMB: 0.4,
    uploadedAt: '2026-02-20T09:14:38Z',
    idpStatus: 'complete',
    pageCount: 1,
  },
];

// ─── Loan IGO Checklist — 12 criteria from Wilton Reassurance Loan Visio ──────
export const LOAN_GOOD_ORDER_CHECKS: GoodOrderCheck[] = [
  {
    id: 'GOC-001',
    description: 'Single correct policy number present on form',
    status: 'pass',
    required: true,
    category: 'Form Identification',
  },
  {
    id: 'GOC-002',
    description: "Owner TIN / SSN last 4 digits match policy records",
    status: 'pass',
    required: true,
    category: 'Identity',
  },
  {
    id: 'GOC-003',
    description: "Owner name on form matches policy owner of record",
    status: 'pass',
    required: true,
    category: 'Identity',
  },
  {
    id: 'GOC-004',
    description: 'Loan request type clearly marked (one option selected)',
    status: 'pass',
    required: true,
    category: 'Form Completeness',
  },
  {
    id: 'GOC-005',
    description: 'Requested amount does not exceed maximum loan available ($110,000)',
    status: 'pass',
    required: true,
    category: 'Financial',
  },
  {
    id: 'GOC-006',
    description: "Alternate payee section blank or contains owner's address only",
    status: 'pass',
    required: true,
    category: 'Payee',
  },
  {
    id: 'GOC-007',
    description: 'Owner signature present in designated signature field (Field 9)',
    status: 'pass',
    required: true,
    category: 'Signature',
  },
  {
    id: 'GOC-008',
    description: 'Signature date within 6 months of receipt and not future-dated',
    status: 'pending',
    required: true,
    category: 'Signature',
    notes: 'Date signed: 02/18/2026 — confirm against case receipt date',
  },
  {
    id: 'GOC-009',
    description: 'Corporate / trust authorization section left blank',
    status: 'pass',
    required: true,
    category: 'Form Completeness',
  },
  {
    id: 'GOC-010',
    description: 'Spousal consent section left blank (non-community property state confirmed)',
    status: 'pass',
    required: true,
    category: 'Form Completeness',
  },
  {
    id: 'GOC-011',
    description: 'Notary section left blank',
    status: 'pass',
    required: true,
    category: 'Form Completeness',
  },
  {
    id: 'GOC-012',
    description: 'Form completed in ink with no alterations or white-out',
    status: 'pending',
    required: true,
    category: 'Form Integrity',
    notes: 'Manual visual inspection required — original document on file',
  },
];

// ─── Demo Scenario 2: Annuity Withdrawal (Low Touch) ──────────────────────────
export const WITHDRAWAL_CASE: CaseRecord = {
  id: 'CSE-2026-010891',
  policyNumber: 'ANN-2024-034891',
  ownerName: 'Patricia M. Chen',
  transactionType: 'Annuity Single Withdrawal',
  transactionTypeKey: 'ANNUITY_WITHDRAWAL',
  channelSource: 'Portal',
  status: 'PENDING_VALIDATION',
  createdAt: '2026-02-20T11:32:07Z',
};

export const WITHDRAWAL_IDP_ENTITIES: IDPEntity[] = [
  // Identity Group — matches Wilton Reassurance Request for Distribution - Fixed Annuity (FIC79AANY-8)
  {
    fieldName: 'policy_number',
    displayName: 'Contract Number',
    extractedValue: 'ANN-2024-034891',
    confidenceScore: 99,
    validated: false,
    corrected: false,
    matchStatus: 'match',
    policyValue: 'ANN-2024-034891',
    group: 'identity',
    required: true,
  },
  {
    fieldName: 'form_date',
    displayName: 'Form Date',
    extractedValue: '02/19/2026',
    confidenceScore: 99,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'identity',
    required: true,
  },
  {
    fieldName: 'owner_name',
    displayName: "Owner's Name",
    extractedValue: 'Patricia M. Chen',
    confidenceScore: 99,
    validated: false,
    corrected: false,
    matchStatus: 'match',
    policyValue: 'Patricia M. Chen',
    group: 'identity',
    required: true,
  },
  {
    fieldName: 'owner_phone',
    displayName: "Owner's Telephone",
    extractedValue: '(650) 555-0217',
    confidenceScore: 91,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'identity',
    required: false,
  },
  {
    fieldName: 'owner_address',
    displayName: 'Home Address',
    extractedValue: '3801 El Camino Real, Palo Alto, CA 94306',
    confidenceScore: 93,
    validated: false,
    corrected: false,
    matchStatus: 'match',
    policyValue: '3801 El Camino Real, Palo Alto, CA 94306',
    group: 'identity',
    required: false,
  },
  {
    fieldName: 'owner_signature',
    displayName: 'Owner Signature',
    extractedValue: 'Present',
    confidenceScore: 96,
    validated: false,
    corrected: false,
    matchStatus: 'match',
    group: 'identity',
    required: true,
  },
  {
    fieldName: 'date_signed',
    displayName: 'Signature Date',
    extractedValue: '02/19/2026',
    confidenceScore: 98,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'identity',
    required: true,
  },
  // Financial Group — Distribution Instructions (Section 3)
  {
    fieldName: 'full_surrender',
    displayName: 'Full Surrender Requested',
    extractedValue: 'No',
    confidenceScore: 99,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'financial',
    required: true,
  },
  {
    fieldName: 'payment_frequency',
    displayName: 'Payment Frequency',
    extractedValue: 'One Time',
    confidenceScore: 98,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'financial',
    required: true,
  },
  {
    fieldName: 'distribution_option',
    displayName: 'Distribution Option',
    extractedValue: 'Option 4: Specified Amount',
    confidenceScore: 97,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'financial',
    required: true,
  },
  {
    fieldName: 'requested_amount',
    displayName: 'Specified Withdrawal Amount',
    extractedValue: '$5,000.00',
    confidenceScore: 97,
    validated: false,
    corrected: false,
    matchStatus: 'pending',
    group: 'financial',
    required: true,
  },
  {
    fieldName: 'net_or_gross',
    displayName: 'Net or Gross Election',
    extractedValue: 'Gross',
    confidenceScore: 94,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'financial',
    required: true,
  },
  // Payment Group — Section 5 Payment Method
  {
    fieldName: 'payment_method',
    displayName: 'Payment Method',
    extractedValue: 'Direct Deposit — Checking',
    confidenceScore: 97,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'payment',
    required: true,
  },
  {
    fieldName: 'bank_routing',
    displayName: 'ABA Routing Number',
    extractedValue: '121042882',
    confidenceScore: 88,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'payment',
    required: true,
  },
  {
    fieldName: 'bank_account',
    displayName: 'Bank Account Number',
    extractedValue: '****7614',
    confidenceScore: 86,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'payment',
    required: true,
  },
  // Tax Group — Withholding Election for Non-Periodic Distributions
  {
    fieldName: 'tax_withholding_federal',
    displayName: 'Federal Withholding Election',
    extractedValue: '10% Withholding',
    confidenceScore: 96,
    validated: false,
    corrected: false,
    matchStatus: 'unavailable',
    group: 'tax',
    required: true,
  },
  {
    fieldName: 'owner_ssn_tin',
    displayName: 'Owner SSN / TIN',
    extractedValue: '***-**-4217',
    confidenceScore: 93,
    validated: false,
    corrected: false,
    matchStatus: 'match',
    policyValue: '***-**-4217',
    group: 'tax',
    required: true,
  },
];

export const WITHDRAWAL_POLICY_ENTITIES: PolicyEntity[] = [
  {
    fieldName: 'policy_status',
    displayName: 'Contract Status',
    value: 'Active',
    retrievedAt: '2026-02-20T11:32:15Z',
    sourceSystem: 'Admin System',
    category: 'Status',
  },
  {
    fieldName: 'account_value',
    displayName: 'Account Value',
    value: '$180,000.00',
    retrievedAt: '2026-02-20T11:32:15Z',
    sourceSystem: 'Admin System',
    category: 'Financials',
  },
  {
    fieldName: 'free_withdrawal_amount',
    displayName: 'Free Withdrawal Available',
    value: '$18,000.00',
    retrievedAt: '2026-02-20T11:32:15Z',
    sourceSystem: 'Admin System',
    category: 'Financials',
  },
  {
    fieldName: 'surrender_charge_rate',
    displayName: 'Surrender Charge Rate',
    value: '0% (Free Corridor)',
    retrievedAt: '2026-02-20T11:32:15Z',
    sourceSystem: 'Admin System',
    category: 'Financials',
  },
  {
    fieldName: 'surrender_charge_period',
    displayName: 'Surrender Charge Period Remaining',
    value: '3 years',
    retrievedAt: '2026-02-20T11:32:15Z',
    sourceSystem: 'Admin System',
    category: 'Financials',
  },
  {
    fieldName: 'tax_qualification',
    displayName: 'Tax Qualification',
    value: 'Non-Qualified',
    retrievedAt: '2026-02-20T11:32:15Z',
    sourceSystem: 'Admin System',
    category: 'Tax',
  },
  {
    fieldName: 'owner_name_policy',
    displayName: 'Owner Name (System)',
    value: 'Patricia M. Chen',
    retrievedAt: '2026-02-20T11:32:15Z',
    sourceSystem: 'Admin System',
    category: 'Identity',
  },
];

export const WITHDRAWAL_WORKFLOW_EVENTS: WorkflowEvent[] = [
  {
    id: 'WE-001',
    eventType: 'CASE_CREATED',
    description: 'Case created from Customer Portal self-service submission',
    actor: 'Portal (pchen)',
    timestamp: '2026-02-20T11:32:07Z',
  },
  {
    id: 'WE-002',
    eventType: 'DOCUMENT_RECEIVED',
    description: 'Withdrawal request form submitted digitally — 1 page',
    actor: 'Portal (pchen)',
    timestamp: '2026-02-20T11:32:07Z',
  },
  {
    id: 'WE-003',
    eventType: 'IDP_COMPLETE',
    description: 'IDP extraction complete — 8 fields extracted, 0 below confidence threshold',
    actor: 'Assure IDP Service',
    timestamp: '2026-02-20T11:32:22Z',
  },
  {
    id: 'WE-004',
    eventType: 'POLICY_DATA_RETRIEVED',
    description: 'Contract data retrieved from Admin System — 7 fields loaded',
    actor: 'System',
    timestamp: '2026-02-20T11:32:24Z',
  },
];

export const WITHDRAWAL_DOCUMENTS: CaseDocument[] = [
  {
    id: 'DOC-001',
    name: 'Withdrawal_Request_ANN034891.pdf',
    type: 'Annuity Withdrawal Request',
    sizeMB: 0.8,
    uploadedAt: '2026-02-20T11:32:07Z',
    idpStatus: 'complete',
    pageCount: 1,
  },
];

// ─── Decision Tables ──────────────────────────────────────────────────────────
export const LOAN_DECISION_TABLE: DecisionTable = {
  id: 'DT_LOAN_TRIAGE_V1',
  name: 'Policy Loan Triage Rules',
  transactionTypeKey: 'LIFE_LOAN',
  version: '2.0',
  status: 'active',
  columns: [
    { id: 'col_mec',        fieldName: 'mec_indicator',          displayName: 'MEC Indicator',       entitySource: 'IDP',      dataType: 'string' },
    { id: 'col_irrev',      fieldName: 'irrev_beneficiary',      displayName: 'Irrev. Beneficiary',  entitySource: 'Policy',   dataType: 'string' },
    { id: 'col_collateral', fieldName: 'collateral_assignment',  displayName: 'Collateral Assign.',  entitySource: 'Policy',   dataType: 'string' },
    { id: 'col_addr_days',  fieldName: 'address_change_days',    displayName: 'Addr Change (days)',  entitySource: 'Workflow', dataType: 'number' },
    { id: 'col_loan_pct',   fieldName: 'loan_amount_pct_of_max', displayName: 'Loan Amt % of Max',   entitySource: 'IDP',      dataType: 'percent', unit: '%' },
    { id: 'col_status',     fieldName: 'policy_status',          displayName: 'Policy Status',       entitySource: 'Policy',   dataType: 'string' },
    { id: 'col_confidence', fieldName: 'idp_confidence_avg',     displayName: 'IDP Confidence',      entitySource: 'IDP',      dataType: 'percent', unit: '%' },
  ],
  rules: [
    {
      id: 'RULE-001',
      order: 1,
      description: 'STP Disqualifier — Policy is a Modified Endowment Contract',
      conditions: [
        { id: 'c01', columnId: 'col_mec',        fieldName: 'mec_indicator',          operator: 'eq',  value: 'Yes' },
        { id: 'c02', columnId: 'col_irrev',       fieldName: 'irrev_beneficiary',      operator: 'any', value: '' },
        { id: 'c03', columnId: 'col_collateral',  fieldName: 'collateral_assignment',  operator: 'any', value: '' },
        { id: 'c04', columnId: 'col_addr_days',   fieldName: 'address_change_days',    operator: 'any', value: '' },
        { id: 'c05', columnId: 'col_loan_pct',    fieldName: 'loan_amount_pct_of_max', operator: 'any', value: '' },
        { id: 'c06', columnId: 'col_status',      fieldName: 'policy_status',          operator: 'any', value: '' },
        { id: 'c07', columnId: 'col_confidence',  fieldName: 'idp_confidence_avg',     operator: 'any', value: '' },
      ],
      outputTouchLevel: 'HIGH',
      isDefault: false,
    },
    {
      id: 'RULE-002',
      order: 2,
      description: 'STP Disqualifier — Irrevocable beneficiary requires consent',
      conditions: [
        { id: 'c08', columnId: 'col_mec',        fieldName: 'mec_indicator',          operator: 'any', value: '' },
        { id: 'c09', columnId: 'col_irrev',       fieldName: 'irrev_beneficiary',      operator: 'neq', value: 'None' },
        { id: 'c10', columnId: 'col_collateral',  fieldName: 'collateral_assignment',  operator: 'any', value: '' },
        { id: 'c11', columnId: 'col_addr_days',   fieldName: 'address_change_days',    operator: 'any', value: '' },
        { id: 'c12', columnId: 'col_loan_pct',    fieldName: 'loan_amount_pct_of_max', operator: 'any', value: '' },
        { id: 'c13', columnId: 'col_status',      fieldName: 'policy_status',          operator: 'any', value: '' },
        { id: 'c14', columnId: 'col_confidence',  fieldName: 'idp_confidence_avg',     operator: 'any', value: '' },
      ],
      outputTouchLevel: 'HIGH',
      isDefault: false,
    },
    {
      id: 'RULE-003',
      order: 3,
      description: 'STP Disqualifier — Collateral assignment (lienholder interest on file)',
      conditions: [
        { id: 'c15', columnId: 'col_mec',        fieldName: 'mec_indicator',          operator: 'any', value: '' },
        { id: 'c16', columnId: 'col_irrev',       fieldName: 'irrev_beneficiary',      operator: 'any', value: '' },
        { id: 'c17', columnId: 'col_collateral',  fieldName: 'collateral_assignment',  operator: 'neq', value: 'None' },
        { id: 'c18', columnId: 'col_addr_days',   fieldName: 'address_change_days',    operator: 'any', value: '' },
        { id: 'c19', columnId: 'col_loan_pct',    fieldName: 'loan_amount_pct_of_max', operator: 'any', value: '' },
        { id: 'c20', columnId: 'col_status',      fieldName: 'policy_status',          operator: 'any', value: '' },
        { id: 'c21', columnId: 'col_confidence',  fieldName: 'idp_confidence_avg',     operator: 'any', value: '' },
      ],
      outputTouchLevel: 'HIGH',
      isDefault: false,
    },
    {
      id: 'RULE-004',
      order: 4,
      description: 'High Touch — Policy not in active status',
      conditions: [
        { id: 'c22', columnId: 'col_mec',        fieldName: 'mec_indicator',          operator: 'any', value: '' },
        { id: 'c23', columnId: 'col_irrev',       fieldName: 'irrev_beneficiary',      operator: 'any', value: '' },
        { id: 'c24', columnId: 'col_collateral',  fieldName: 'collateral_assignment',  operator: 'any', value: '' },
        { id: 'c25', columnId: 'col_addr_days',   fieldName: 'address_change_days',    operator: 'any', value: '' },
        { id: 'c26', columnId: 'col_loan_pct',    fieldName: 'loan_amount_pct_of_max', operator: 'any', value: '' },
        { id: 'c27', columnId: 'col_status',      fieldName: 'policy_status',          operator: 'neq', value: 'Active' },
        { id: 'c28', columnId: 'col_confidence',  fieldName: 'idp_confidence_avg',     operator: 'any', value: '' },
      ],
      outputTouchLevel: 'HIGH',
      isDefault: false,
    },
    {
      id: 'RULE-005',
      order: 5,
      description: 'High Touch — Loan amount ≥ 90% of maximum available',
      conditions: [
        { id: 'c29', columnId: 'col_mec',        fieldName: 'mec_indicator',          operator: 'any', value: '' },
        { id: 'c30', columnId: 'col_irrev',       fieldName: 'irrev_beneficiary',      operator: 'any', value: '' },
        { id: 'c31', columnId: 'col_collateral',  fieldName: 'collateral_assignment',  operator: 'any', value: '' },
        { id: 'c32', columnId: 'col_addr_days',   fieldName: 'address_change_days',    operator: 'any', value: '' },
        { id: 'c33', columnId: 'col_loan_pct',    fieldName: 'loan_amount_pct_of_max', operator: 'gte', value: '90' },
        { id: 'c34', columnId: 'col_status',      fieldName: 'policy_status',          operator: 'any', value: '' },
        { id: 'c35', columnId: 'col_confidence',  fieldName: 'idp_confidence_avg',     operator: 'any', value: '' },
      ],
      outputTouchLevel: 'HIGH',
      isDefault: false,
    },
    {
      id: 'RULE-006',
      order: 6,
      description: 'Moderate Touch — Address change within 30 days (STP flag, review required)',
      conditions: [
        { id: 'c36', columnId: 'col_mec',        fieldName: 'mec_indicator',          operator: 'any', value: '' },
        { id: 'c37', columnId: 'col_irrev',       fieldName: 'irrev_beneficiary',      operator: 'any', value: '' },
        { id: 'c38', columnId: 'col_collateral',  fieldName: 'collateral_assignment',  operator: 'any', value: '' },
        { id: 'c39', columnId: 'col_addr_days',   fieldName: 'address_change_days',    operator: 'lte', value: '30' },
        { id: 'c40', columnId: 'col_loan_pct',    fieldName: 'loan_amount_pct_of_max', operator: 'lt',  value: '90' },
        { id: 'c41', columnId: 'col_status',      fieldName: 'policy_status',          operator: 'eq',  value: 'Active' },
        { id: 'c42', columnId: 'col_confidence',  fieldName: 'idp_confidence_avg',     operator: 'any', value: '' },
      ],
      outputTouchLevel: 'MODERATE',
      isDefault: false,
    },
    {
      id: 'RULE-007',
      order: 7,
      description: 'STP — All clear, loan < 50% of max, no STP flags',
      conditions: [
        { id: 'c43', columnId: 'col_mec',        fieldName: 'mec_indicator',          operator: 'eq',  value: 'No' },
        { id: 'c44', columnId: 'col_irrev',       fieldName: 'irrev_beneficiary',      operator: 'eq',  value: 'None' },
        { id: 'c45', columnId: 'col_collateral',  fieldName: 'collateral_assignment',  operator: 'eq',  value: 'None' },
        { id: 'c46', columnId: 'col_addr_days',   fieldName: 'address_change_days',    operator: 'gt',  value: '30' },
        { id: 'c47', columnId: 'col_loan_pct',    fieldName: 'loan_amount_pct_of_max', operator: 'lt',  value: '50' },
        { id: 'c48', columnId: 'col_status',      fieldName: 'policy_status',          operator: 'eq',  value: 'Active' },
        { id: 'c49', columnId: 'col_confidence',  fieldName: 'idp_confidence_avg',     operator: 'gt',  value: '95' },
      ],
      outputTouchLevel: 'STP',
      isDefault: false,
    },
    {
      id: 'RULE-008',
      order: 8,
      description: 'Low Touch — Loan < 75% of max, no STP flags, good confidence',
      conditions: [
        { id: 'c50', columnId: 'col_mec',        fieldName: 'mec_indicator',          operator: 'eq',  value: 'No' },
        { id: 'c51', columnId: 'col_irrev',       fieldName: 'irrev_beneficiary',      operator: 'eq',  value: 'None' },
        { id: 'c52', columnId: 'col_collateral',  fieldName: 'collateral_assignment',  operator: 'eq',  value: 'None' },
        { id: 'c53', columnId: 'col_addr_days',   fieldName: 'address_change_days',    operator: 'gt',  value: '30' },
        { id: 'c54', columnId: 'col_loan_pct',    fieldName: 'loan_amount_pct_of_max', operator: 'lt',  value: '75' },
        { id: 'c55', columnId: 'col_status',      fieldName: 'policy_status',          operator: 'eq',  value: 'Active' },
        { id: 'c56', columnId: 'col_confidence',  fieldName: 'idp_confidence_avg',     operator: 'gt',  value: '90' },
      ],
      outputTouchLevel: 'LOW',
      isDefault: false,
    },
    {
      id: 'RULE-009',
      order: 9,
      description: 'Moderate Touch — Standard amount range, active policy',
      conditions: [
        { id: 'c57', columnId: 'col_mec',        fieldName: 'mec_indicator',          operator: 'any', value: '' },
        { id: 'c58', columnId: 'col_irrev',       fieldName: 'irrev_beneficiary',      operator: 'any', value: '' },
        { id: 'c59', columnId: 'col_collateral',  fieldName: 'collateral_assignment',  operator: 'any', value: '' },
        { id: 'c60', columnId: 'col_addr_days',   fieldName: 'address_change_days',    operator: 'any', value: '' },
        { id: 'c61', columnId: 'col_loan_pct',    fieldName: 'loan_amount_pct_of_max', operator: 'lt',  value: '90' },
        { id: 'c62', columnId: 'col_status',      fieldName: 'policy_status',          operator: 'eq',  value: 'Active' },
        { id: 'c63', columnId: 'col_confidence',  fieldName: 'idp_confidence_avg',     operator: 'gt',  value: '70' },
      ],
      outputTouchLevel: 'MODERATE',
      isDefault: false,
    },
    {
      id: 'RULE-DEFAULT',
      order: 10,
      description: 'Default — All other cases',
      conditions: [],
      outputTouchLevel: 'MODERATE',
      isDefault: true,
    },
  ],
};

export const WITHDRAWAL_DECISION_TABLE: DecisionTable = {
  id: 'DT_WITHDRAWAL_TRIAGE_V1',
  name: 'Annuity Withdrawal Triage Rules',
  transactionTypeKey: 'ANNUITY_WITHDRAWAL',
  version: '2.0',
  status: 'active',
  columns: [
    { id: 'col_mec',        fieldName: 'mec_indicator',     displayName: 'MEC Indicator',      entitySource: 'IDP',    dataType: 'string' },
    { id: 'col_irrev',      fieldName: 'irrev_beneficiary', displayName: 'Irrev. Beneficiary', entitySource: 'Policy', dataType: 'string' },
    { id: 'col_corridor',   fieldName: 'within_free_corridor', displayName: 'Within Free Corridor', entitySource: 'IDP', dataType: 'string' },
    { id: 'col_status',     fieldName: 'policy_status',     displayName: 'Contract Status',    entitySource: 'Policy', dataType: 'string' },
    { id: 'col_confidence', fieldName: 'idp_confidence_avg', displayName: 'IDP Confidence',    entitySource: 'IDP',    dataType: 'percent', unit: '%' },
  ],
  rules: [
    {
      id: 'RULE-001',
      order: 1,
      description: 'STP Disqualifier — Contract is a Modified Endowment Contract',
      conditions: [
        { id: 'c01', columnId: 'col_mec',        fieldName: 'mec_indicator',      operator: 'eq',  value: 'Yes' },
        { id: 'c02', columnId: 'col_irrev',       fieldName: 'irrev_beneficiary',  operator: 'any', value: '' },
        { id: 'c03', columnId: 'col_corridor',    fieldName: 'within_free_corridor', operator: 'any', value: '' },
        { id: 'c04', columnId: 'col_status',      fieldName: 'policy_status',      operator: 'any', value: '' },
        { id: 'c05', columnId: 'col_confidence',  fieldName: 'idp_confidence_avg', operator: 'any', value: '' },
      ],
      outputTouchLevel: 'HIGH',
      isDefault: false,
    },
    {
      id: 'RULE-002',
      order: 2,
      description: 'STP Disqualifier — Irrevocable beneficiary requires written consent',
      conditions: [
        { id: 'c06', columnId: 'col_mec',        fieldName: 'mec_indicator',      operator: 'any', value: '' },
        { id: 'c07', columnId: 'col_irrev',       fieldName: 'irrev_beneficiary',  operator: 'neq', value: 'None' },
        { id: 'c08', columnId: 'col_corridor',    fieldName: 'within_free_corridor', operator: 'any', value: '' },
        { id: 'c09', columnId: 'col_status',      fieldName: 'policy_status',      operator: 'any', value: '' },
        { id: 'c10', columnId: 'col_confidence',  fieldName: 'idp_confidence_avg', operator: 'any', value: '' },
      ],
      outputTouchLevel: 'HIGH',
      isDefault: false,
    },
    {
      id: 'RULE-003',
      order: 3,
      description: 'High Touch — Contract not in active status',
      conditions: [
        { id: 'c11', columnId: 'col_mec',        fieldName: 'mec_indicator',      operator: 'any', value: '' },
        { id: 'c12', columnId: 'col_irrev',       fieldName: 'irrev_beneficiary',  operator: 'any', value: '' },
        { id: 'c13', columnId: 'col_corridor',    fieldName: 'within_free_corridor', operator: 'any', value: '' },
        { id: 'c14', columnId: 'col_status',      fieldName: 'policy_status',      operator: 'neq', value: 'Active' },
        { id: 'c15', columnId: 'col_confidence',  fieldName: 'idp_confidence_avg', operator: 'any', value: '' },
      ],
      outputTouchLevel: 'HIGH',
      isDefault: false,
    },
    {
      id: 'RULE-004',
      order: 4,
      description: 'Low Touch — Within free corridor, STP-clear, high confidence',
      conditions: [
        { id: 'c16', columnId: 'col_mec',        fieldName: 'mec_indicator',      operator: 'eq',  value: 'No' },
        { id: 'c17', columnId: 'col_irrev',       fieldName: 'irrev_beneficiary',  operator: 'eq',  value: 'None' },
        { id: 'c18', columnId: 'col_corridor',    fieldName: 'within_free_corridor', operator: 'eq', value: 'Yes' },
        { id: 'c19', columnId: 'col_status',      fieldName: 'policy_status',      operator: 'eq',  value: 'Active' },
        { id: 'c20', columnId: 'col_confidence',  fieldName: 'idp_confidence_avg', operator: 'gt',  value: '95' },
      ],
      outputTouchLevel: 'LOW',
      isDefault: false,
    },
    {
      id: 'RULE-005',
      order: 5,
      description: 'Moderate Touch — Exceeds free corridor, active, acceptable confidence',
      conditions: [
        { id: 'c21', columnId: 'col_mec',        fieldName: 'mec_indicator',      operator: 'any', value: '' },
        { id: 'c22', columnId: 'col_irrev',       fieldName: 'irrev_beneficiary',  operator: 'any', value: '' },
        { id: 'c23', columnId: 'col_corridor',    fieldName: 'within_free_corridor', operator: 'eq', value: 'No' },
        { id: 'c24', columnId: 'col_status',      fieldName: 'policy_status',      operator: 'eq',  value: 'Active' },
        { id: 'c25', columnId: 'col_confidence',  fieldName: 'idp_confidence_avg', operator: 'gt',  value: '85' },
      ],
      outputTouchLevel: 'MODERATE',
      isDefault: false,
    },
    {
      id: 'RULE-DEFAULT',
      order: 6,
      description: 'Default — All other cases',
      conditions: [],
      outputTouchLevel: 'MODERATE',
      isDefault: true,
    },
  ],
};

// ─── Available Entity Fields for DTBuilder Selector ───────────────────────────
export const ALL_ENTITY_FIELDS: EntityField[] = [
  // IDP Fields
  { fieldName: 'requested_amount',       displayName: 'Requested Amount',       entitySource: 'IDP',      dataType: 'number',  unit: '$', description: 'Dollar amount requested on form' },
  { fieldName: 'loan_amount_pct_of_max', displayName: 'Loan Amt % of Max',      entitySource: 'IDP',      dataType: 'percent', unit: '%', description: 'Requested as % of max available' },
  { fieldName: 'loan_type',              displayName: 'Loan Type',               entitySource: 'IDP',      dataType: 'string',            description: 'New Loan or Repayment' },
  { fieldName: 'within_free_corridor',   displayName: 'Within Free Corridor',    entitySource: 'IDP',      dataType: 'string',            description: 'Withdrawal within penalty-free amount' },
  { fieldName: 'mec_indicator',          displayName: 'MEC Indicator',           entitySource: 'IDP',      dataType: 'string',            description: 'Policy or contract is a Modified Endowment Contract (IRC §7702A)' },
  { fieldName: 'idp_confidence_avg',     displayName: 'IDP Confidence (Avg)',    entitySource: 'IDP',      dataType: 'percent', unit: '%', description: 'Average extraction confidence score' },
  { fieldName: 'owner_signature',        displayName: 'Signature Present',       entitySource: 'IDP',      dataType: 'string',            description: 'Owner signature detected on form' },
  { fieldName: 'tax_withholding_federal',displayName: 'Federal Withholding',     entitySource: 'IDP',      dataType: 'string',            description: 'Federal tax withholding election' },
  // Policy Fields
  { fieldName: 'policy_status',          displayName: 'Policy Status',           entitySource: 'Policy',   dataType: 'string',            description: 'Active, Lapsed, Paid-Up, etc.' },
  { fieldName: 'irrev_beneficiary',      displayName: 'Irrev. Beneficiary',      entitySource: 'Policy',   dataType: 'string',            description: 'Irrevocable beneficiary named on policy / contract' },
  { fieldName: 'collateral_assignment',  displayName: 'Collateral Assignment',   entitySource: 'Policy',   dataType: 'string',            description: 'Collateral assignment (lienholder interest) on record' },
  { fieldName: 'community_property_state', displayName: 'Community Prop. State', entitySource: 'Policy',   dataType: 'string',            description: "Owner's state of residence is a community property state" },
  { fieldName: 'cash_surrender_value',   displayName: 'Cash Surrender Value',    entitySource: 'Policy',   dataType: 'number',  unit: '$', description: 'Current CSV as of valuation date' },
  { fieldName: 'existing_loan_balance',  displayName: 'Existing Loan Balance',   entitySource: 'Policy',   dataType: 'string',            description: 'None or outstanding principal' },
  { fieldName: 'max_loan_available',     displayName: 'Max Loan Available',      entitySource: 'Policy',   dataType: 'number',  unit: '$', description: 'CSV minus loans minus reserve' },
  { fieldName: 'free_withdrawal_amount', displayName: 'Free Withdrawal Avail.',  entitySource: 'Policy',   dataType: 'number',  unit: '$', description: 'Remaining penalty-free withdrawal' },
  { fieldName: 'surrender_charge_rate',  displayName: 'Surrender Charge %',      entitySource: 'Policy',   dataType: 'percent', unit: '%', description: 'Current surrender charge percentage' },
  { fieldName: 'tax_qualification',      displayName: 'Tax Qualification',       entitySource: 'Policy',   dataType: 'string',            description: 'Qualified vs non-qualified' },
  // Workflow Fields
  { fieldName: 'address_change_days',          displayName: 'Addr. Change (days)',      entitySource: 'Workflow', dataType: 'number',            description: 'Days since most recent mailing address change on record' },
  { fieldName: 'channel_source',               displayName: 'Channel Source',           entitySource: 'Workflow', dataType: 'string',            description: 'Portal, Mail/Fax, Call Center, etc.' },
  { fieldName: 'prior_transaction_count',      displayName: 'Prior Transaction Count',  entitySource: 'Workflow', dataType: 'number',            description: 'Number of prior transactions on policy' },
  { fieldName: 'idp_confidence_min',           displayName: 'IDP Confidence (Min)',     entitySource: 'Workflow', dataType: 'percent', unit: '%', description: 'Lowest field confidence score' },
  { fieldName: 'days_since_last_transaction',  displayName: 'Days Since Last Txn',      entitySource: 'Workflow', dataType: 'number',            description: 'Days since prior transaction' },
];
